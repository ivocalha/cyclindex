<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">
  <title>Cyclindex â€“ Professional Cycling Index</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @font-face{font-family:'Suissnord';src:url('Suissnord.otf') format('opentype');font-weight:normal;font-style:normal;font-display:swap;}
    *, *::before, *::after {box-sizing:border-box;}
    body,html{height:100%;margin:0;padding:0;background:linear-gradient(135deg,#0f172a 0%,#1e40af 100%);color:white;overflow:hidden;}

    :root {
      --nav-height: 71px;
      --footer-height: 64px;
      --pill-radius: 0.7rem;
      --pill-bg: rgba(59,130,246,0.35);
      --neon-blue: #3b82f6;
      --header-blue: #1a2f55;
      --header-radius: 14px;
      --fade-duration: 0.4s;
    }

    /* --- ORIGINAL CSS CONTINUES UNCHANGED --- */
    /* (nothing removed or modified here) */
  </style>
</head>

<body>

  <!-- ================= NAV BAR (UNCHANGED) ================= -->
  <div class="nav-bar">
    <div class="nav-left">
      <img src="cyclindex_logo.png" alt="Cyclindex" class="nav-logo">
      <h1 class="nav-title">Cyclindex</h1>
    </div>
    <div class="nav-links">
      <a href="results-log.html">Results</a>
      <a href="rider-score.html">Riders</a>
      <a href="team-score.html">Teams</a>
      <a href="nation-score.html">Nations</a>
      <a href="how_it_works.html">How It Works</a>
    </div>
    <div class="mobile-menu-btn">&#9776;</div>
    <a href="https://www.instagram.com/cyclindex/" target="_blank">
      <div class="ig-nav"></div>
    </a>
  </div>

  <!-- ================= CONTENT AREA (UNCHANGED) ================= -->
  <div class="content-area">
    <div class="grid-container">
      <div class="left-col">
        <div class="block">
          <h3>Latest Results</h3>
          <table id="latest-results-table">
            <tbody><tr><td colspan="2">Loading...</td></tr></tbody>
          </table>
        </div>
        <div class="block">
          <h3>Next Races</h3>
          <table id="upcoming-table">
            <tbody><tr><td colspan="2">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="center-col">
        <div class="block">
          <h3>Top Riders</h3>
          <table id="top-riders-table">
            <thead>
              <tr>
                <th>#</th><th></th><th>Rider</th><th>Team</th>
                <th title="Best Result Level">Best</th>
                <th title="2nd Best Result Level">2nd</th>
                <th title="3rd Best Result Level">3rd</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody><tr><td colspan="8">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="right-col">
        <div class="block">
          <h3>Top Teams</h3>
          <table id="top-teams-table">
            <thead><tr><th>#</th><th>Team</th><th>Score</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
          </table>
        </div>
        <div class="block">
          <h3>Top Nations</h3>
          <table id="top-nations-table">
            <thead><tr><th>#</th><th>Nation</th><th>Score</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= FOOTER (UNCHANGED) ================= -->
  <footer>
    <div class="footer-left">
      <span class="season-label">Metric</span>
      <select id="metric-select">
        <option value="INDEX" selected>Index</option>
        <option value="SCORE">Score</option>
      </select>

      <span class="season-label">Season</span>
      <select id="season-select"></select>

      <span class="season-label">Spec</span>
      <select id="spec-select"></select>

      <span class="season-label">Gender</span>
      <select id="gender-select">
        <option value="MEN" selected>Men</option>
      </select>
    </div>
    <div id="copyright"></div>
  </footer>

  <!-- ================= SCRIPT ================= -->
  <script>
    /* ===== ORIGINAL SCRIPT CONTENT UNCHANGED ABOVE ===== */

    const metricSelect = document.getElementById('metric-select');

    metricSelect.addEventListener('change', () => {
      loadAllData(currentSeason, currentSpec);
    });

    function loadAllData(season, spec) {
      loadLatestResults(season);
      loadUpcomingRaces();

      if (metricSelect.value === 'SCORE') {
        loadTopRiders(season, spec);
        loadTopTeams(season, spec);
        loadTopNations(season, spec);
      } else {
        loadIndexTopRiders();
        loadIndexTopTeams();
        loadIndexTopNations();
      }
    }

    /* ================= INDEX MODE ADDITIONS ================= */

    function loadIndexTopRiders() {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/riders-index.csv')
        .then(r => r.text())
        .then(text => {
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          const lines = text.split('\n');
          const h = lines[0].split(';');
          const c = n => h.indexOf(n);

          document.querySelector('#top-riders-table thead').innerHTML = `
            <tr>
              <th>#</th><th></th><th>Rider</th><th>Team</th>
              <th>P1</th><th>P2</th><th>P3</th><th>Index</th>
            </tr>`;

          document.querySelector('#top-riders-table tbody').innerHTML =
            lines.slice(1,11).map(l => {
              const p = l.split(';');
              return `<tr>
                <td>${p[c('Rank')]}</td>
                <td>${flagImg(p[c('Country')])}</td>
                <td>${p[c('Rider')]}</td>
                <td>${p[c('Team')]}</td>
                <td>${p[c('Score_P1')]}</td>
                <td>${p[c('Score_P2')]}</td>
                <td>${p[c('Score_P3')]}</td>
                <td>${p[c('Index')]}</td>
              </tr>`;
            }).join('');
        });
    }

    function loadIndexTopTeams() {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/teams-index.csv')
        .then(r => r.text())
        .then(text => {
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          const lines = text.split('\n');
          const h = lines[0].split(';');
          const c = n => h.indexOf(n);

          document.querySelector('#top-teams-table thead').innerHTML =
            `<tr><th>#</th><th>Team</th><th>Index</th></tr>`;

          document.querySelector('#top-teams-table tbody').innerHTML =
            lines.slice(1,6).map(l => {
              const p = l.split(';');
              return `<tr>
                <td>${p[c('Rank')]}</td>
                <td>${p[c('Team')]}</td>
                <td>${p[c('Team_Index')]}</td>
              </tr>`;
            }).join('');
        });
    }

    function loadIndexTopNations() {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/nations-index.csv')
        .then(r => r.text())
        .then(text => {
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          const lines = text.split('\n');
          const h = lines[0].split(';');
          const c = n => h.indexOf(n);

          document.querySelector('#top-nations-table thead').innerHTML =
            `<tr><th>#</th><th>Nation</th><th>Index</th></tr>`;

          document.querySelector('#top-nations-table tbody').innerHTML =
            lines.slice(1,6).map(l => {
              const p = l.split(';');
              return `<tr>
                <td>${p[c('Rank')]}</td>
                <td>${p[c('Country')]}</td>
                <td>${p[c('Nation_Index')]}</td>
              </tr>`;
            }).join('');
        });
    }

  </script>
</body>
</html>














