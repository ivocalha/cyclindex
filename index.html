<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">
  <title>Cyclindex – Professional Cycling Index</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @font-face{font-family:'Suissnord';src:url('Suissnord.otf') format('opentype');font-weight:normal;font-style:normal;font-display:swap;}
    *, *::before, *::after {box-sizing:border-box;}
    body,html{height:100%;margin:0;padding:0;background:linear-gradient(135deg,#0f172a 0%,#1e40af 100%);color:white;overflow:hidden;}

    :root{--nav-height:72px;--footer-height:50px;--pill-bg:rgba(59,130,246,0.35);}

    .nav-bar{position:fixed;top:0;left:0;right:0;height:var(--nav-height);background:rgba(15,23,42,0.96);backdrop-filter:blur(16px);display:flex;align-items:center;justify-content:space-between;padding:0 1.8rem;z-index:3000;box-shadow:0 4px 20px rgba(0,0,0,0.5);}
    .nav-left{display:flex;align-items:center;gap:0.9rem;}
    .nav-logo{height:36px;filter:drop-shadow(0 1px 4px rgba(0,0,0,0.5));}
    .nav-title{font-family:'Suissnord',sans-serif;font-size:1.55rem;margin:0;color:white;}
    .nav-links{display:flex;gap:1.6rem;align-items:center;}
    .nav-links a{font-family:'Suissnord',sans-serif;font-size:1.55rem;color:white;padding:0.4rem 0.85rem;border-radius:0.7rem;text-decoration:none;transition:all .18s;}
    .nav-links a:hover{background:var(--pill-bg);transform:translateY(-2px);}
    .ig-nav{width:34px;height:34px;background:url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="white" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>') center/contain no-repeat;transition:transform .25s ease;}
    .ig-nav:hover{transform:scale(1.22) rotate(10deg);}

    .content-area{position:fixed;top:var(--nav-height);bottom:var(--footer-height);left:0;right:0;display:flex;align-items:center;justify-content:center;padding:1.2rem;overflow:hidden;}
    .grid-container{display:grid;grid-template-columns:280px 1fr 420px;gap:1.4rem;width:100%;max-width:1920px;height:100%;}
    .left-col,.center-col,.right-col{display:grid;gap:1.4rem;}
    .right-col{grid-template-rows:1fr 1fr;}

    .block{background:rgba(15,23,42,0.46);backdrop-filter:blur(12px);border-radius:0.9rem;padding:0.95rem;box-shadow:0 5px 20px rgba(0,0,0,0.35);transition:all .35s;overflow:hidden;}
    .block:hover{background:rgba(15,23,42,0.68);transform:translateY(-7px);box-shadow:0 16px 40px rgba(0,0,0,0.5);}
    .block h3{font-family:'Suissnord',sans-serif;font-size:1.22rem;margin:0 0 0.5rem;}

    table{width:100%;border-collapse:collapse;font-size:0.85rem;}
    th{text-align:left;font-weight:600;font-size:0.78rem;opacity:0.9;padding-bottom:0.35rem;border-bottom:1px solid rgba(255,255,255,0.2);}
    td{padding:0.3rem 0;border-bottom:1px solid rgba(255,255,255,0.08);}
    tr:last-child td{border:none;}

    #latest-results-table th:nth-child(1), #upcoming-table th:nth-child(1){width:90px;text-align:left;}
    #latest-results-table th:nth-child(2), #upcoming-table th:nth-child(2){width:auto;text-align:left;}
    #latest-results-table td:nth-child(1), #upcoming-table td:nth-child(1){font-size:0.8rem;opacity:0.95;}
    #latest-results-table td:nth-child(2), #upcoming-table td:nth-child(2){font-size:0.8rem;opacity:0.95;}

    .flag-img{width:24px;height:16px;vertical-align:middle;margin-right:0.3rem;border:1px solid rgba(255,255,255,0.2);border-radius:2px;}

    .fixed-bottom-bar{position:fixed;bottom:0;left:0;right:0;height:var(--footer-height);background:rgba(15,23,42,0.95);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:space-between;padding:0 1.25rem;box-shadow:0 -6px 20px rgba(0,0,0,0.45);z-index:2900;}
    .footer-left,.footer-right{display:flex;align-items:center;gap:8px;}
    .footer-left{font-size:0.8rem;opacity:0.85;}
    .footer-right{font-size:0.8rem;opacity:0.85;}
    .footer-ig{width:26px;height:26px;background:url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="white" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>') center/contain no-repeat;transition:transform .25s ease;}
    .footer-ig:hover{transform:scale(1.22) rotate(10deg);}

    .tooltip{position:absolute;background:rgba(0,0,0,0.8);color:white;padding:4px 8px;border-radius:4px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:9999;}
    .flag-container{position:relative;display:inline-block;cursor:pointer;}
    .flag-container:hover .tooltip{opacity:1;}
  </style>
</head>
<body>
  <nav class="nav-bar">
    <div class="nav-left">
      <img src="cyclindex_logo.png" alt="Cyclindex Logo" class="nav-logo">
      <h1 class="nav-title">Cyclindex</h1>
    </div>
    <div class="nav-links">
      <a href="rider-score.html">Riders</a>
      <a href="team-score.html">Teams</a>
      <a href="nation-score.html">Nations</a>
      <a href="results-log.html">Results</a>
    </div>
    <a href="https://www.instagram.com/cyclindex/" target="_blank" class="ig-nav"></a>
  </nav>

  <div class="content-area">
    <div class="grid-container">
      <div class="left-col">
        <div class="block">
          <h3>Top Riders</h3>
          <table id="top-riders-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Nat</th>
                <th>Rider</th>
                <th>Team</th>
                <th>1st</th>
                <th>2nd</th>
                <th>3rd</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="center-col">
        <div class="block">
          <h3>Latest Results</h3>
          <table id="latest-results-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Competition</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="right-col">
        <div class="block">
          <h3>Top Teams</h3>
          <table id="top-teams-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Team</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <h3 class="mt-4">Top Nations</h3>
          <table id="top-nations-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Nation</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="block">
          <h3>Upcoming Races</h3>
          <table id="upcoming-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Race</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <footer class="fixed-bottom-bar">
    <div class="footer-left flex items-center gap-2">
      <span class="font-semibold text-sm opacity-85">Season:</span>
      <select id="season-select" class="bg-[rgba(59,130,246,0.35)] text-white text-sm px-3 py-1 rounded-[0.7rem] outline-none cursor-pointer transition-all hover:bg-[rgba(59,130,246,0.45)]">
        <option value="2025">2025</option>
      </select>
      <span class="font-semibold text-sm opacity-85">Spec:</span>
      <select id="spec-select" class="bg-[rgba(59,130,246,0.35)] text-white text-sm px-3 py-1 rounded-[0.7rem] outline-none cursor-pointer transition-all hover:bg-[rgba(59,130,246,0.45)]">
      </select>
    </div>
    <div class="footer-right flex items-center gap-2">
      <span>Follow us on Instagram</span>
      <a href="https://www.instagram.com/cyclindex/" target="_blank" class="footer-ig"></a>
    </div>
  </footer>

  <script>
    const seasonSelect = document.getElementById('season-select');
    const specSelect = document.getElementById('spec-select');

    async function loadSpecs() {
      const response = await fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/rider-score.csv');
      let text = await response.text();
      if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
      const lines = text.split('\n');
      const specs = new Set();
      for (let i = 1; i < lines.length; i++) {
        const p = lines[i].split(';');
        if (p.length >= 2 && p[1]?.trim()) {
          specs.add(p[1].trim());
        }
      }
      const sortedSpecs = Array.from(specs).sort();
      sortedSpecs.forEach(spec => {
        const option = document.createElement('option');
        option.value = spec;
        option.textContent = spec;
        specSelect.appendChild(option);
      });
      specSelect.value = 'OVERALL';
    }

    loadSpecs();

    function flagImg(nation) {
      const codes = {
        "Afghanistan": "af", "Albania": "al", "Algeria": "dz", "Andorra": "ad", "Angola": "ao", "Antigua and Barbuda": "ag",
        "Argentina": "ar", "Armenia": "am", "Australia": "au", "Austria": "at", "Azerbaijan": "az", "Bahamas": "bs",
        "Bahrain": "bh", "Bangladesh": "bd", "Barbados": "bb", "Belarus": "by", "Belgium": "be", "Belize": "bz",
        "Benin": "bj", "Bhutan": "bt", "Bolivia": "bo", "Bosnia and Herzegovina": "ba", "Botswana": "bw", "Brazil": "br",
        "Brunei": "bn", "Bulgaria": "bg", "Burkina Faso": "bf", "Burundi": "bi", "Cambodia": "kh", "Cameroon": "cm",
        "Canada": "ca", "Cape Verde": "cv", "Central African Republic": "cf", "Chad": "td", "Chile": "cl", "China": "cn",
        "Colombia": "co", "Comoros": "km", "Congo": "cg", "Costa Rica": "cr", "Croatia": "hr", "Cuba": "cu",
        "Cyprus": "cy", "Czech Republic": "cz", "Czechia": "cz", "Denmark": "dk", "Djibouti": "dj", "Dominica": "dm",
        "Dominican Republic": "do", "DR Congo": "cd", "Ecuador": "ec", "Egypt": "eg", "El Salvador": "sv",
        "Equatorial Guinea": "gq", "Eritrea": "er", "Estonia": "ee", "Eswatini": "sz", "Ethiopia": "et", "Fiji": "fj",
        "Finland": "fi", "France": "fr", "Gabon": "ga", "Gambia": "gm", "Georgia": "ge", "Germany": "de", "Ghana": "gh",
        "Greece": "gr", "Grenada": "gd", "Guatemala": "gt", "Guinea": "gn", "Guinea-Bissau": "gw", "Guyana": "gy",
        "Haiti": "ht", "Honduras": "hn", "Hong Kong": "hk", "Hungary": "hu", "Iceland": "is", "India": "in",
        "Indonesia": "id", "Iran": "ir", "Iraq": "iq", "Ireland": "ie", "Israel": "il", "Italy": "it", "Ivory Coast": "ci",
        "Jamaica": "jm", "Japan": "jp", "Jordan": "jo", "Kazakhstan": "kz", "Kenya": "ke", "Kiribati": "ki",
        "Kosovo": "xk", "Kuwait": "kw", "Kyrgyzstan": "kg", "Laos": "la", "Latvia": "lv", "Lebanon": "lb",
        "Lesotho": "ls", "Liberia": "lr", "Libya": "ly", "Liechtenstein": "li", "Lithuania": "lt", "Luxembourg": "lu",
        "Madagascar": "mg", "Malawi": "mw", "Malaysia": "my", "Maldives": "mv", "Mali": "ml", "Malta": "mt",
        "Marshall Islands": "mh", "Mauritania": "mr", "Mauritius": "mu", "Mexico": "mx", "Micronesia": "fm",
        "Moldova": "md", "Monaco": "mc", "Mongolia": "mn", "Montenegro": "me", "Morocco": "ma", "Mozambique": "mz",
        "Myanmar": "mm", "Namibia": "na", "Nauru": "nr", "Nepal": "np", "Netherlands": "nl", "New Zealand": "nz",
        "Nicaragua": "ni", "Niger": "ne", "Nigeria": "ng", "North Korea": "kp", "North Macedonia": "mk", "Norway": "no",
        "Oman": "om", "Pakistan": "pk", "Palau": "pw", "Palestine": "ps", "Panama": "pa", "Papua New Guinea": "pg",
        "Paraguay": "py", "Peru": "pe", "Philippines": "ph", "Poland": "pl", "Portugal": "pt", "Qatar": "qa",
        "Romania": "ro", "Russia": "ru", "Rwanda": "rw", "Saint Kitts and Nevis": "kn", "Saint Lucia": "lc",
        "Saint Vincent and the Grenadines": "vc", "Samoa": "ws", "San Marino": "sm", "Sao Tome and Principe": "st",
        "Saudi Arabia": "sa", "Senegal": "sn", "Serbia": "rs", "Seychelles": "sc", "Sierra Leone": "sl",
        "Singapore": "sg", "Slovakia": "sk", "Slovenia": "si", "Solomon Islands": "sb", "Somalia": "so",
        "South Africa": "za", "South Korea": "kr", "South Sudan": "ss", "Spain": "es", "Sri Lanka": "lk",
        "Sudan": "sd", "Suriname": "sr", "Sweden": "se", "Switzerland": "ch", "Syria": "sy", "Taiwan": "tw",
        "Tajikistan": "tj", "Tanzania": "tz", "Thailand": "th", "Timor-Leste": "tl", "Togo": "tg", "Tonga": "to",
        "Trinidad and Tobago": "tt", "Tunisia": "tn", "Turkey": "tr", "Turkmenistan": "tm", "Uganda": "ug",
        "Ukraine": "ua", "United Arab Emirates": "ae", "United Kingdom": "gb", "Great Britain": "gb",
        "United States": "us", "Uruguay": "uy", "Uzbekistan": "uz", "Vanuatu": "vu", "Vatican City": "va",
        "Venezuela": "ve", "Vietnam": "vn", "Yemen": "ye", "Zambia": "zm", "Zimbabwe": "zw", "Réunion": "re",
        "Isle of Man": "im", "Hong Kong": "hk"
      };
      const code = codes[nation] || '';
      return code ? `<div class="flag-container"><img class="flag-img" src="https://flagcdn.com/w20/${code}.png" alt="${nation}"><div class="tooltip">${nation}</div></div>` : nation;
    }

    function fmt(val) {
      if (!val) return '0';
      return parseFloat(val).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
    }

    function loadTopRiders(season, spec) {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/rider-score.csv')
        .then(r => r.text())
        .then(text => {
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          const lines = text.split('\n');
          const top = [];
          for (let i = 1; i < lines.length; i++) {
            const p = lines[i].split(';');
            if (p.length < 31) continue;
            if (p[0]?.trim() !== season || p[1]?.trim() !== spec) continue;
            const rank = parseInt(p[2], 10);
            if (rank >= 1 && rank <= 10) {
              top.push({
                rank,
                nation: p[4].trim(),
                rider: p[3].trim(),
                team: p[8].trim(),
                best: fmt(p[15]),
                second: fmt(p[21]),
                third: fmt(p[27]),
                score: fmt(p[28])
              });
            }
          }
          top.sort((a,b) => a.rank - b.rank);
          document.querySelector('#top-riders-table tbody').innerHTML = top.length
            ? top.map(t => `<tr><td>${t.rank}</td><td>${flagImg(t.nation)}</td><td>${t.rider}</td><td>${t.team}</td><td>${t.best}</td><td>${t.second}</td><td>${t.third}</td><td>${t.score}</td></tr>`).join('')
            : '<tr><td colspan="8">No data</td></tr>';
        });
    }

    function loadTopTeams(season, spec) {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/team-score.csv')
        .then(r => r.text())
        .then(t => {
          if (t.charCodeAt(0) === 0xFEFF) t = t.slice(1);
          const lines = t.split('\n');
          const out = [];
          for (let i = 1; i < lines.length; i++) {
            const p = lines[i].split(';');
            if (p.length < 17) continue;
            if (p[0]?.trim() !== season || p[1]?.trim() !== spec) continue;
            const rank = parseInt(p[2]);
            if (rank > 0 && rank <= 5) out.push({rank, team: p[3].trim(), score: fmt(p[16])});
          }
          out.sort((a,b)=>a.rank-b.rank);
          document.querySelector('#top-teams-table tbody').innerHTML = out.length
            ? out.map(x=>`<tr><td>${x.rank}</td><td>${x.team}</td><td>${x.score}</td></tr>`).join('')
            : '<tr><td colspan="3">No data</td></tr>';
        });
    }

    function loadTopNations(season, spec) {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/nation-score.csv')
        .then(r => r.text())
        .then(t => {
          if (t.charCodeAt(0) === 0xFEFF) t = t.slice(1);
          const lines = t.split('\n');
          const out = [];
          for (let i = 1; i < lines.length; i++) {
            const p = lines[i].split(';');
            if (p.length < 15) continue;
            if (p[0]?.trim() !== season || p[1]?.trim() !== spec) continue;
            const rank = parseInt(p[2]);
            if (rank > 0 && rank <= 5) out.push({rank, nation: p[3].trim(), score: fmt(p[14])});
          }
          out.sort((a,b)=>a.rank-b.rank);
          document.querySelector('#top-nations-table tbody').innerHTML = out.length
            ? out.map(x=>`<tr><td>${x.rank}</td><td>${x.nation}</td><td>${x.score}</td></tr>`).join('')
            : '<tr><td colspan="3">No data</td></tr>';
        });
    }

    function loadLatestResults(season) {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/results-log.csv')
        .then(r => r.text())
        .then(text => {
          if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
          const lines = text.split('\n');
          const results = [];
          for (let i = 1; i < lines.length; i++) {
            const p = lines[i].split(';');
            if (p.length < 19) continue;
            if (p[8]?.trim() !== season) continue;
            results.push(p);
            if (results.length === 5) break;
          }
          results.sort((a,b) => new Date(b[7].split('/').reverse().join('-')) - new Date(a[7].split('/').reverse().join('-')));
          document.querySelector('#latest-results-table tbody').innerHTML = results.length
            ? results.map(p => `<tr><td>${p[7].trim()}</td><td>${p[9].trim()}</td></tr>`).join('')
            : '<tr><td colspan="2">No recent results</td></tr>';
        });
    }

    function loadUpcomingRaces() {
      fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/calendar.csv')
        .then(r => r.text())
        .then(csv => {
          const lines = csv.trim().split('\n').slice(1);
          const today = new Date(); today.setHours(0,0,0,0);
          const upcoming = [];
          for (const line of lines) {
            const p = line.split(';');
            if (p.length < 5) continue;
            const [d,m,y] = p[0].trim().split('/');
            const raceDate = new Date(`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`);
            if (raceDate >= today) {
              upcoming.push(p);
              if (upcoming.length === 5) break;
            }
          }
          document.querySelector('#upcoming-table tbody').innerHTML = upcoming.length
            ? upcoming.map(p => `<tr><td>${p[0].trim()}</td><td>${p[2].trim()}</td></tr>`).join('')
            : '<tr><td colspan="2">No upcoming races</td></tr>';
        });
    }

    function updateData() {
      const season = seasonSelect.value;
      const spec = specSelect.value;
      loadTopRiders(season, spec);
      loadTopTeams(season, spec);
      loadTopNations(season, spec);
      loadLatestResults(season);
    }

    seasonSelect.addEventListener('change', updateData);
    specSelect.addEventListener('change', updateData);

    updateData();
    loadUpcomingRaces();
  </script>
</body>
</html>
