<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">
  <title>Results Log – Cyclindex</title>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.tailwindcss.css">

  <style>
    @font-face {
      font-family: 'Suissnord';
      src: url('Suissnord.otf') format('opentype');
      font-display: swap;
    }
    body {
      background:#0f172a;
      color:white;
      margin:0;
      padding:0;
      overflow:hidden;   /* IMPORTANT → no page scroll */
    }

    /* FIXED NAVBAR */
    .nav-bar {
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(12px);
      padding: 1rem 2rem;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 2000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .nav-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .nav-links a {
      color: white;
      font-family: 'Suissnord', sans-serif;
      font-size: 1.1rem;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 0.8rem;
      transition: all 0.3s;
    }
    .nav-links a:hover {
      background: rgba(59,130,246,0.4);
      transform: translateY(-2px);
    }
    .nav-links a.active {
      background: rgba(59,130,246,0.4);
    }

    /* TABLE WRAPPER MUST FIT BETWEEN TOP AND BOTTOM BARS */
    .table-wrapper {
      position: fixed;
      top: 94px;                     /* nav height + spacing */
      bottom: 64px;                  /* fixed bottom bar height */
      left: 0;
      right: 0;
      padding: 0 1.5rem;
      overflow: hidden;
    }

    /* SCROLLING TABLE BODY ONLY */
    #resultsTable_wrapper .dataTables_scrollBody {
      overflow-y: auto !important;
      overflow-x: auto !important;
      height: 100% !important;
    }

    /* FIX duplicate header row */
    #resultsTable thead tr:not(:first-child) {
      display: none !important;
    }

    /* TABLE STYLE */
    #resultsTable {
      background:rgba(255,255,255,0.08);
      border-radius: 1.5rem;
      overflow:hidden;
      backdrop-filter:blur(24px);
      width:100%;
    }
    #resultsTable thead th {
      background:#1e40af !important;
      font-family:'Suissnord',sans-serif;
      font-size:1.1rem !important;
      padding:1rem 0.5rem !important;
      text-align:center;
      font-weight:bold;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    #resultsTable tbody td {
      padding:0.6rem 0.4rem !important;
      text-align:center;
      vertical-align:middle;
      font-size:0.89rem;
    }
    #resultsTable tbody tr:hover {
      background:rgba(59,130,246,0.28) !important;
    }

    /* FLAGS */
    .flag-img { width:23px; height:17px; border-radius:2px; transition:transform .2s; }
    .flag-img:hover { transform:scale(2.2); }
    .flag-container { position:relative; display:inline-block; cursor:help; }
    .tooltip {
      position:absolute; bottom:100%; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,0.94); color:white; padding:6px 10px;
      border-radius:6px; font-size:0.84rem; opacity:0;
      white-space:nowrap; transition:opacity .2s; margin-bottom:6px;
    }
    .flag-container:hover .tooltip { opacity:1; }

    /* FIXED BOTTOM BAR — FULL WIDTH */
    .fixed-bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: rgba(15,23,42,0.95);
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      z-index: 1500;
      font-size: 0.95rem;
    }

    .fixed-bottom-bar .dataTables_paginate,
    .fixed-bottom-bar .dataTables_info,
    .fixed-bottom-bar .dataTables_filter {
      margin: 0 !important;
    }

    /* Make filter box smaller for footer */
    .fixed-bottom-bar .dataTables_filter input {
      width: 160px !important;
    }
  </style>
</head>

<body>

  <!-- FIXED NAV -->
  <nav class="nav-bar">
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="results-log.html" class="active">Results Log</a>
      <a href="rider-score.html">Rider Score</a>
      <a href="team-score.html">Team Score</a>
      <a href="nation-score.html">Nation Score</a>
      <a href="how-it-works.html">How It Works</a>
    </div>
  </nav>

  <!-- TABLE SECTION -->
  <div class="table-wrapper">
    <table id="resultsTable" class="display nowrap" style="width:100%">
      <thead>
        <tr>
          <th>Date</th>
          <th>Nation</th>
          <th>Rider</th>
          <th>Team</th>
          <th>Race</th>
          <th>Class</th>
          <th>Rank</th>
          <th>Type</th>
          <th>UCI Pts</th>
          <th>Level</th>
          <th><span title="Rider's Season Result Rank">RSRR</span></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- FIXED BOTTOM CONTROL BAR -->
  <div class="fixed-bottom-bar" id="footerBar">
    <div class="footer-left"></div>
    <div class="footer-center"></div>
    <div class="footer-right"></div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_URL = "https://raw.githubusercontent.com/ivocalha/cyclindex/main/results-log.csv";

    const countryFlags = {
      "Belgium":"be","France":"fr","Italy":"it","Spain":"es","Portugal":"pt","Netherlands":"nl",
      /* truncated to save space → keep your full list here */
    };

    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);

        const parsed = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: true,
          delimiter: ";",
          trimHeaders: true,
          transformHeader: h => h.trim(),
          transform: v => v ? v.trim() : ""
        });

        const columnsToShow = [
          "Date","Country","Rider","Team","Competition","Class",
          "Rank","Result Type","UCI Points","Level","Season Result Rank"
        ];

        const tableData = parsed.data
          .filter(r => r.Date && r.Rider)
          .map(row => {
            const country = row["Country"];
            const code = countryFlags[country] || "";
            const flagHtml = code
              ? `<div class="flag-container"><img src="https://flagcdn.com/48x36/${code}.png" class="flag-img"><div class="tooltip">${country}</div></div>`
              : country;

            return columnsToShow.map(col => col === "Country" ? flagHtml : row[col] ?? "");
          });

        const dt = $('#resultsTable').DataTable({
          data: tableData,
          columns: [
            { title: "Date" }, { title: "Nation" }, { title: "Rider" },
            { title: "Team" }, { title: "Race" }, { title: "Class" },
            { title: "Rank" }, { title: "Type" }, { title: "UCI Pts" },
            { title: "Level" },
            { title: '<span title="Rider&#39;s Season Result Rank">RSRR</span>' }
          ],

          scrollY: '100%',     /* table body fills wrapper */
          scrollX: true,
          scrollCollapse: true,

          pageLength: 100,
          order: [[0, 'desc']],

          dom: 'rtip',         /* we manually place footer controls */

          autoWidth: false,

          columnDefs: [
            {
              targets: 0,
              type: 'date',
              render: function (data, type) {
                if (type === 'sort') {
                  const [d, m, y] = data.split('/');
                  return `${y}-${m}-${d}`;
                }
                return data;
              }
            }
          ]
        });

        /* Move pagination, info, filter into fixed footer */
        document.querySelector('.footer-left').append(
          document.querySelector('#resultsTable_wrapper .dataTables_paginate')
        );
        document.querySelector('.footer-center').append(
          document.querySelector('#resultsTable_wrapper .dataTables_info')
        );
        document.querySelector('.footer-right').append(
          document.querySelector('#resultsTable_wrapper .dataTables_filter')
        );
      });
  </script>

</body>
</html>
