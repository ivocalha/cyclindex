<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Results Log – Cyclindex</title>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">

  <!-- Tailwind + DataTables -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.tailwindcss.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">

  <style>
    @font-face {
      font-family: 'Suissnord';
      src: url('Suissnord.otf') format('opentype');
      font-display: swap;
    }
    html, body { height: 100%; margin: 0; background: #0f172a; color: white; overflow: hidden; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }

    /* NAVBAR */
    .nav-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 71px;
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(12px);
      padding: 1rem 2rem;
      z-index: 2200;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .nav-links a {
      color: white;
      font-family: 'Suissnord', sans-serif;
      font-size: 1.05rem;
      padding: 0.45rem 0.9rem;
      border-radius: 0.7rem;
      text-decoration: none;
      transition: all .18s;
    }
    .nav-links a:hover { background: rgba(59,130,246,0.35); transform: translateY(-2px); }
    .nav-links a.active { background: rgba(59,130,246,0.35); }

    /* MAIN CONTENT – flex column that fills space between nav and footer */
    .main-content {
      height: calc(100vh - 71px - 64px);   /* exact space between navbar and bottom bar */
      margin-top: 71px;                    /* push below navbar */
      display: flex;
      flex-direction: column;
    }

    /* Table container – takes all remaining height */
    .table-container {
      flex: 1;
      overflow: hidden;
      padding: 12px 18px;
    }

    /* FOOTER BAR */
    .fixed-bottom-bar {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: 64px;
      background: rgba(15,23,42,0.95);
      backdrop-filter: blur(12px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.25rem;
      z-index: 2100;
      box-shadow: 0 -6px 20px rgba(0,0,0,0.45);
    }
    .footer-left, .footer-center, .footer-right { display: flex; align-items: center; gap: 8px; }
    .footer-center { flex: 1; justify-content: center; }
    .footer-left { min-width: 200px; }
    .footer-right { min-width: 220px; justify-content: flex-end; }

    /* Search */
    .search-wrap input {
      width: 220px;
      padding: 6px 10px;
      border-radius: 6px;
      background: rgba(255,255,255,0.06);
      border: none;
      outline: none;
      color: white;
    }
    .magnifier { width: 18px; height: 18px; filter: invert(1) grayscale(1) brightness(2); }

    /* Table styling */
    #resultsTable {
      width: 100% !important;
      background: rgba(255,255,255,0.06);
      border-radius: 1rem;
      backdrop-filter: blur(18px);
      box-shadow: 0 30px 90px rgba(0,0,0,0.85);
    }
    #resultsTable thead th {
      background: #1e40af !important;
      font-family: 'Suissnord', sans-serif;
      font-size: 1.02rem !important;
      padding: 0.85rem 0.5rem !important;
      text-align: center;
      font-weight: 700;
      white-space: nowrap;
    }
    #resultsTable tbody td {
      padding: 0.55rem 0.4rem !important;
      font-size: 0.89rem;
      text-align: center;
      white-space: nowrap;
    }
    #resultsTable tbody tr:hover { background: rgba(59,130,246,0.12) !important; }

    /* Flags */
    .flag-img { width: 22px; height: 16px; border-radius: 2px; box-shadow: 0 1px 3px rgba(0,0,0,0.35); transition: transform .18s; }
    .flag-img:hover { transform: scale(2); }
    .flag-container { display: inline-block; position: relative; cursor: pointer; }
    .flag-container .tooltip {
      position: absolute;
      bottom: 100%; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.9);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: .84rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity .15s;
      margin-bottom: 6px;
      pointer-events: none;
      z-index: 3000;
    }
    .flag-container:hover .tooltip { opacity: 1; }
  </style>
</head>
<body class="text-white">

  <!-- NAVBAR -->
  <nav class="nav-bar">
    <div class="nav-links w-full flex justify-center flex-wrap gap-8">
      <a href="index.html">Home</a>
      <a href="results-log.html" class="active">Results Log</a>
      <a href="rider-score.html">Rider Score</a>
      <a href="team-score.html">Team Score</a>
      <a href="nation-score.html">Nation Score</a>
      <a href="how-it-works.html">How It Works</a>
    </div>
  </nav>

  <!-- MAIN FLEX CONTENT -->
  <div class="main-content">
    <div class="table-container">
      <table id="resultsTable" class="display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Date</th>
            <th>Nation</th>
            <th>Rider</th>
            <th>Team</th>
            <th>Race</th>
            <th>Class</th>
            <th>Rank</th>
            <th>Type</th>
            <th>UCI Pts</th>
            <th>Level</th>
            <th><span title="Rider's Season Result Rank">RSRR</span></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="fixed-bottom-bar">
    <div class="footer-left" id="pagContainer"></div>
    <div class="footer-center" id="infoContainer"></div>
    <div class="footer-right">
      <div class="search-wrap flex items-center gap-2">
        <svg class="magnifier" viewBox="0 0 24 24">
          <path d="M11 19a8 8 0 1 1 5.293-14.293A8 8 0 0 1 11 19zm8.707 3.707L18 18"
                stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input id="footerSearch" placeholder="Search…" />
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    const countryFlags = { /* your huge flag object – unchanged */ };

    const CSV_URL = "https://raw.githubusercontent.com/ivocalha/cyclindex/main/results-log.csv";

    /* Pagination & Info helpers – unchanged */
    function buildPagination(container, info, table) { /* ... same as yours ... */ }
    function updateInfo(container, info) {
      container.textContent = `Showing ${info.start + 1} to ${info.end} of ${info.recordsDisplay} entries`;
    }

    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
        const parsed = Papa.parse(text, {
          header: true, skipEmptyLines: true, dynamicTyping: true,
          delimiter: ";", trimHeaders: true,
          transformHeader: h => h.trim(),
          transform: v => v ? v.trim() : ""
        });

        const cols = ["Date","Country","Rider","Team","Competition","Class","Rank","Result Type","UCI Points","Level","Season Result Rank"];
        const data = parsed.data
          .filter(r => r.Date && r.Rider)
          .map(row => {
            const country = row["Country"] || "";
            const code = countryFlags[country];
            const flagHTML = code
              ? `<div class="flag-container">
                   <img src="https://flagcdn.com/${code}.svg" class="flag-img" loading="lazy">
                   <div class="tooltip">${country}</div>
                 </div>`
              : country;
            return cols.map(c => (c === "Country" ? flagHTML : (row[c] || "")));
          });

        const table = $('#resultsTable').DataTable({
          data: data,
          dom: "t",
          scrollY: false,           // we control height via CSS flex
          scrollX: true,
          scrollCollapse: true,
          fixedHeader: true,        // <-- this gives you a perfectly sticky header
          pageLength: 100,
          order: [[0, "desc"]],
          autoWidth: false,
          pagingType: "full_numbers",
          language: { paginate: { previous: "←", next: "→", first: "«", last: "»" } },
          columnDefs: [{
            targets: 0,
            type: "date",
            render: (d, type) => {
              if ((type === "sort" || type === "type") && d.includes("/")) {
                const [day, mon, yr] = d.split("/");
                return `${yr}-${mon.padStart(2,"0")}-${day.padStart(2,"0")}`;
              }
              return d;
            }
          }]
        });

        const pag = document.getElementById("pagContainer");
        const inf = document.getElementById("infoContainer");
        const search = document.getElementById("footerSearch");

        search.addEventListener("input", () => table.search(search.value).draw());

        table.on("draw", () => {
          const info = table.page.info();
          buildPagination(pag, info, table);
          updateInfo(inf, info);
        });

        // initial draw
        table.draw();
      });
  </script>
</body>
</html>
