<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">
  <title>Rider Score – Cyclindex</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.tailwindcss.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.1.2/css/buttons.tailwindcss.css">
  <style>
    @font-face { font-family: 'Suissnord'; src: url('Suissnord.otf') format('opentype'); font-display: swap; }
    body { background:#0f172a; color:white; margin:0; padding:0; }
    h1 { font-family: 'Suissnord', sans-serif; font-size: clamp(4.5rem, 9vw, 7rem); text-align:center; padding:10rem 0 4rem; background:linear-gradient(to bottom,#1e3a8a,#0f172a); text-shadow:0 8px 40px #000; margin:0; }
    .container { padding:2rem 4vw 12rem; max-width:3000px; margin:0 auto; }
    #riderTable { background:rgba(255,255,255,0.08); backdrop-filter:blur(24px); border-radius:2rem; overflow:hidden; box-shadow:0 40px 120px rgba(0,0,0,0.95); font-size:0.94rem; }
    #riderTable thead th { background:#1e40af !important; font-family:'Suissnord',sans-serif; font-size:1.2rem !important; padding:1.1rem 0.6rem !important; text-align:center; font-weight:bold; }
    #riderTable tbody td { padding:0.8rem 0.5rem !important; text-align:center; vertical-align:middle; font-size:0.94rem; }
    #riderTable tbody tr:hover { background:rgba(59,130,246,0.28) !important; }
    .flag-img { width:26px; height:19.5px; border-radius:3px; box-shadow:0 1px 3px rgba(0,0,0,0.6); transition:transform .2s; }
    .flag-img:hover { transform:scale(2); }
    .tooltip { position:absolute; bottom:100%; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.94); color:white; padding:7px 11px; border-radius:6px; font-size:0.86rem; white-space:nowrap; pointer-events:none; opacity:0; transition:opacity .2s; margin-bottom:6px; z-index:1000; }
    .flag-container:hover .tooltip { opacity:1; }
    .flag-container { position:relative; display:inline-block; cursor:help; }
  </style>
</head>
<body>

  <h1>RIDER SCORE</h1>

  <div class="container">
    <table id="riderTable" class="display nowrap" style="width:100%">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Country</th>
          <th>Rider</th>
          <th>Team 1</th><th>Date 1</th><th>Event 1</th><th>Rk1</th><th>Type 1</th><th>Lvl 1</th>
          <th>Team 2</th><th>Date 2</th><th>Event 2</th><th>Rk2</th><th>Type 2</th><th>Lvl 2</th>
          <th>Team 3</th><th>Date 3</th><th>Event 3</th><th>Rk3</th><th>Type 3</th><th>Lvl 3</th>
          <th>Score</th>
          <th>Team Rank</th>
          <th>Country Rank</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/dataTables.buttons.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.colVis.js"></script>
  <script src="https://cdn.datatables.net/buttons/3.1.2/js/buttons.html5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_URL = "https://raw.githubusercontent.com/ivocalha/cyclindex/main/rider-score.csv";

    // ALL 249 COUNTRIES IN THE WORLD (ISO 3166-1 alpha-2) – NO COUNTRY LEFT BEHIND
    const countryFlags = {
      "Afghanistan":"af","Albania":"al","Algeria":"dz","American Samoa":"as","Andorra":"ad",
      "Angola":"ao","Anguilla":"ai","Antarctica":"aq","Antigua and Barbuda":"ag","Argentina":"ar",
      "Armenia":"am","Aruba":"aw","Australia":"au","Austria":"at","Azerbaijan":"az",
      "Bahamas":"bs","Bahrain":"bh","Bangladesh":"bd","Barbados":"bb","Belarus":"by",
      "Belgium":"be","Belize":"bz","Benin":"bj","Bermuda":"bm","Bhutan":"bt",
      "Bolivia":"bo","Bosnia and Herzegovina":"ba","Botswana":"bw","Bouvet Island":"bv","Brazil":"br",
      "British Indian Ocean Territory":"io","Brunei":"bn","Bulgaria":"bg","Burkina Faso":"bf","Burundi":"bi",
      "Cabo Verde":"cv","Cambodia":"kh","Cameroon":"cm","Canada":"ca","Cayman Islands":"ky",
      "Central African Republic":"cf","Chad":"td","Chile":"cl","China":"cn","Christmas Island":"cx",
      "Cocos (Keeling) Islands":"cc","Colombia":"co","Comoros":"km","Congo (Brazzaville)":"cg","Congo (Kinshasa)":"cd",
      "Cook Islands":"ck","Costa Rica":"cr","Croatia":"hr","Cuba":"cu","Curaçao":"cw",
      "Cyprus":"cy","Czechia":"cz","Denmark":"dk","Djibouti":"dj","Dominica":"dm",
      "Dominican Republic":"do","Ecuador":"ec","Egypt":"eg","El Salvador":"sv","Equatorial Guinea":"gq",
      "Eritrea":"er","Estonia":"ee","Eswatini":"sz","Ethiopia":"et","Falkland Islands":"fk",
      "Faroe Islands":"fo","Fiji":"fj","Finland":"fi","France":"fr","French Guiana":"gf",
      "French Polynesia":"pf","French Southern Territories":"tf","Gabon":"ga","Gambia":"gm","Georgia":"ge",
      "Germany":"de","Ghana":"gh","Gibraltar":"gi","Greece":"gr","Greenland":"gl",
      "Grenada":"gd","Guadeloupe":"gp","Guam":"gu","Guatemala":"gt","Guernsey":"gg",
      "Guinea":"gn","Guinea-Bissau":"gw","Guyana":"gy","Haiti":"ht","Heard Island and McDonald Islands":"hm",
      "Honduras":"hn","Hong Kong":"hk","Hungary":"hu","Iceland":"is","India":"in",
      "Indonesia":"id","Iran":"ir","Iraq":"iq","Ireland":"ie","Isle of Man":"im",
      "Israel":"il","Italy":"it","Ivory Coast":"ci","Jamaica":"jm","Japan":"jp",
      "Jersey":"je","Jordan":"jo","Kazakhstan":"kz","Kenya":"ke","Kiribati":"ki",
      "Kosovo":"xk","Kuwait":"kw","Kyrgyzstan":"kg","Laos":"la","Latvia":"lv",
      "Lebanon":"lb","Lesotho":"ls","Liberia":"lr","Libya":"ly","Liechtenstein":"li",
      "Lithuania":"lt","Luxembourg":"lu","Macao":"mo","Madagascar":"mg","Malawi":"mw",
      "Malaysia":"my","Maldives":"mv","Mali":"ml","Malta":"mt","Marshall Islands":"mh",
      "Martinique":"mq","Mauritania":"mr","Mauritius":"mu","Mayotte":"yt","Mexico":"mx",
      "Micronesia":"fm","Moldova":"md","Monaco":"mc","Mongolia":"mn","Montenegro":"me",
      "Montserrat":"ms","Morocco":"ma","Mozambique":"mz","Myanmar":"mm","Namibia":"na",
      "Nauru":"nr","Nepal":"np","Netherlands":"nl","New Caledonia":"nc","New Zealand":"nz",
      "Nicaragua":"ni","Niger":"ne","Nigeria":"ng","Niue":"nu","Norfolk Island":"nf",
      "North Korea":"kp","North Macedonia":"mk","Northern Mariana Islands":"mp","Norway":"no","Oman":"om",
      "Pakistan":"pk","Palau":"pw","Palestine":"ps","Panama":"pa","Papua New Guinea":"pg",
      "Paraguay":"py","Peru":"pe","Philippines":"ph","Pitcairn":"pn","Poland":"pl",
      "Portugal":"pt","Puerto Rico":"pr","Qatar":"qa","Réunion":"re","Romania":"ro",
      "Russia":"ru","Rwanda":"rw","Saint Barthélemy":"bl","Saint Helena":"sh","Saint Kitts and Nevis":"kn",
      "Saint Lucia":"lc","Saint Martin":"mf","Saint Pierre and Miquelon":"pm","Saint Vincent and the Grenadines":"vc","Samoa":"ws",
      "San Marino":"sm","Sao Tome and Principe":"st","Saudi Arabia":"sa","Senegal":"sn","Serbia":"rs",
      "Seychelles":"sc","Sierra Leone":"sl","Singapore":"sg","Sint Maarten":"sx","Slovakia":"sk",
      "Slovenia":"si","Solomon Islands":"sb","Somalia":"so","South Africa":"za","South Georgia":"gs",
      "South Korea":"kr","South Sudan":"ss","Spain":"es","Sri Lanka":"lk","Sudan":"sd",
      "Suriname":"sr","Svalbard and Jan Mayen":"sj","Sweden":"se","Switzerland":"ch","Syria":"sy",
      "Taiwan":"tw","Tajikistan":"tj","Tanzania":"tz","Thailand":"th","Timor-Leste":"tl",
      "Togo":"tg","Tokelau":"tk","Tonga":"to","Trinidad and Tobago":"tt","Tunisia":"tn",
      "Turkey":"tr","Turkmenistan":"tm","Turks and Caicos Islands":"tc","Tuvalu":"tv","Uganda":"ug",
      "Ukraine":"ua","United Arab Emirates":"ae","United Kingdom":"gb","United States":"us","Uruguay":"uy",
      "Uzbekistan":"uz","Vanuatu":"vu","Vatican City":"va","Venezuela":"ve","Vietnam":"vn",
      "Virgin Islands (British)":"vg","Virgin Islands (U.S.)":"vi","Wallis and Futuna":"wf","Western Sahara":"eh","Yemen":"ye",
      "Zambia":"zm","Zimbabwe":"zw"
    };

    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);

        const parsed = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
          dynamicTyping: true,
          delimiter: ";",
          trimHeaders: true,
          transformHeader: h => h.trim(),
          transform: v => v ? v.trim() : ""
        });

        const columnsToShow = [
          "Rank","Country","Rider",
          "Team1","Date1","Event1","Rank1","Results_Type1","Level1",
          "Team2","Date2","Event2","Rank2","Results_Type2","Level2",
          "Team3","Date3","Event3","Rank3","Results_Type3","Level3",
          "Score","rider_team_rank","rider_country_rank"
        ];

        const tableData = parsed.data
          .filter(r => r.Rank && r.Rider)
          .map(row => {
            const country = row["Country"] || "";
            const code = countryFlags[country] || "";
            const flagHtml = code 
              ? `<div class="flag-container">
                   <img src="https://flagcdn.com/48x36/${code}.png" class="flag-img" alt="${country}" loading="lazy">
                   <div class="tooltip">${country}</div>
                 </div>`
              : country;

            return columnsToShow.map(col => col === "Country" ? flagHtml : (row[col] ?? ""));
          });

        $('#riderTable').DataTable({
          data: tableData,
          columns: columnsToShow.map((title, i) => ({
            title: [
              "Rank","Country","Rider",
              "Team 1","Date 1","Event 1","Rk1","Type 1","Lvl 1",
              "Team 2","Date 2","Event 2","Rk2","Type 2","Lvl 2",
              "Team 3","Date 3","Event 3","Rk3","Type 3","Lvl 3",
              "Score","Team Rank","Country Rank"
            ][i]
          })),
          pageLength: 100,
          lengthMenu: [50, 100, 250],
          order: [[0, 'asc']],
          scrollX: true,
          colReorder: true,
          dom: 'Bfrtip',
          buttons: ['colvis', {extend:'csv', text:'Export CSV'}, 'copy'],
          language: { search: "Search riders:", lengthMenu: "Show _MENU_ riders" },
          columnDefs: [
            { width: "60px",  targets: 0 },
            { width: "50px",  targets: 1 },
            { width: "240px", targets: 2 },
            { width: "160px", targets: 3 }, { width: "92px", targets: 4 }, { width: "220px", targets: 5 },
            { width: "52px",  targets: 6 }, { width: "92px",  targets: 7 }, { width: "62px",  targets: 8 },
            { width: "160px", targets: 9 }, { width: "92px", targets: 10 }, { width: "220px", targets: 11 },
            { width: "52px",  targets: 12 }, { width: "92px",  targets: 13 }, { width: "62px",  targets: 14 },
            { width: "160px", targets: 15 }, { width: "92px", targets: 16 }, { width: "220px", targets: 17 },
            { width: "52px",  targets: 18 }, { width: "92px",  targets: 19 }, { width: "62px",  targets: 20 },
            { width: "100px", targets: 21 },
            { width: "88px",  targets: 22 },
            { width: "96px",  targets: 23 }
          ]
        });
      });
  </script>
</body>
</html>
