<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rider Score – Cyclindex</title>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.tailwindcss.css">

  <style>
    @font-face {
      font-family: 'Suissnord';
      src: url('Suissnord.otf') format('opentype');
      font-display: swap;
    }

    :root {
      --nav-height: 71px;
      --footer-height: 64px;
      --pill-radius: 0.7rem;
      --pill-bg: rgba(59,130,246,0.35);
      --neon-blue: #3b82f6;
      --header-blue: #1a2f55;
      --header-radius: 14px;
      --fade-duration: 0.4s;
    }

    html, body { height: 100%; margin: 0; overflow: hidden; }
    body {
      background: #0f172a;
      color: white;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    .nav-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--nav-height);
      background: rgba(15,23,42,0.9);
      backdrop-filter: blur(12px);
      display: flex; align-items: center;
      padding: 1rem 2rem;
      z-index: 3000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .nav-links {
      display: flex;
      gap: 2rem;
      width: 100%;
      justify-content: center;
    }
    .nav-links a {
      font-family: 'Suissnord', sans-serif;
      text-decoration: none;
      color: white;
      font-size: 1.55rem;
      padding: 0.5rem 1rem;
      border-radius: var(--pill-radius);
      transition: all 0.25s ease;
    }
    .nav-links a:hover {
      background: var(--pill-bg);
      transform: translateY(-2px);
    }

    /* Exact same flag styling as index.html */
    .flag-container {
      position: relative;
      display: inline-block;
      cursor: pointer;
    }
    .flag-img {
      width: 28px;
      height: 20px;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.6);
      object-fit: cover;
      transition: transform 0.2s ease;
    }
    .flag-container:hover .flag-img {
      transform: scale(1.7);
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.92);
      color: white;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      margin-bottom: 6px;
      z-index: 100;
    }
    .flag-container:hover .tooltip {
      opacity: 1;
    }

    .content {
      position: fixed;
      top: var(--nav-height);
      left: 0; right: 0; bottom: var(--footer-height);
      overflow: auto;
      padding: 2rem;
    }
    .table-container {
      background: rgba(15,23,42,0.5);
      backdrop-filter: blur(12px);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }

    footer {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: var(--footer-height);
      background: rgba(15,23,42,0.95);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      font-size: 0.9rem;
      color: rgba(255,255,255,0.7);
      z-index: 2000;
    }
  </style>
</head>
<body>

  <!-- Navbar with updated names -->
  <div class="nav-bar">
    <div class="nav-links">
      <a href="results-log.html">Results</a>
      <a href="rider-score.html">Riders</a>
      <a href="team-score.html">Teams</a>
      <a href="nation-score.html">Nations</a>
      <a href="how-it-works.html">How It Works</a>
    </div>
  </div>

  <div class="content">
    <div class="table-container">
      <table id="riderTable" class="display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Nation</th>
            <th>Rider</th>
            <th>Team</th>
            <th>YOB</th>
            <th>Best Result</th>
            <th>2nd Best</th>
            <th>3rd Best</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <footer>
    <div id="infoContainer">Loading...</div>
    <div id="pagContainer"></div>
    <input type="text" id="footerSearch" placeholder="Search..." style="background:rgba(15,23,42,0.8);border:1px solid rgba(255,255,255,0.3);border-radius:8px;padding:0.5rem 1rem;color:white;outline:none;">
  </footer>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.tailwindcss.min.js"></script>

  <script>
    const countryFlags = {"Afghanistan":"af","Albania":"al","Algeria":"dz","Andorra":"ad","Angola":"ao","Antigua and Barbuda":"ag","Argentina":"ar","Armenia":"am","Australia":"au","Austria":"at","Azerbaijan":"az","Bahamas":"bs","Bahrain":"bh","Bangladesh":"bd","Barbados":"bb","Belarus":"by","Belgium":"be","Belize":"bz","Benin":"bj","Bermuda":"bm","Bhutan":"bt","Bolivia":"bo","Bosnia and Herzegovina":"ba","Botswana":"bw","Brazil":"br","Brunei":"bn","Bulgaria":"bg","Burkina Faso":"bf","Burundi":"bi","Cambodia":"kh","Cameroon":"cm","Canada":"ca","Cape Verde":"cv","Cayman Islands":"ky","Central African Republic":"cf","Chad":"td","Chile":"cl","China":"cn","Colombia":"co","Comoros":"km","Congo":"cg","Costa Rica":"cr","Croatia":"hr","Cuba":"cu","Cyprus":"cy","Czech Republic":"cz","Denmark":"dk","Djibouti":"dj","Dominica":"dm","Dominican Republic":"do","Ecuador":"ec","Egypt":"eg","El Salvador":"sv","Equatorial Guinea":"gq","Eritrea":"er","Estonia":"ee","Eswatini":"sz","Ethiopia":"et","Fiji":"fj","Finland":"fi","France":"fr","Gabon":"ga","Gambia":"gm","Georgia":"ge","Germany":"de","Ghana":"gh","Greece":"gr","Grenada":"gd","Guatemala":"gt","Guinea":"gn","Guinea-Bissau":"gw","Guyana":"gy","Haiti":"ht","Honduras":"hn","Hong Kong":"hk","Hungary":"hu","Iceland":"is","India":"in","Indonesia":"id","Iran":"ir","Iraq":"iq","Ireland":"ie","Israel":"il","Italy":"it","Ivory Coast":"ci","Jamaica":"jm","Japan":"jp","Jordan":"jo","Kazakhstan":"kz","Kenya":"ke","Kiribati":"ki","Kosovo":"xk","Kuwait":"kw","Kyrgyzstan":"kg","Laos":"la","Latvia":"lv","Lebanon":"lb","Lesotho":"ls","Liberia":"lr","Libya":"ly","Liechtenstein":"li","Lithuania":"lt","Luxembourg":"lu","Madagascar":"mg","Malawi":"mw","Malaysia":"my","Maldives":"mv","Mali":"ml","Malta":"mt","Marshall Islands":"mh","Mauritania":"mr","Mauritius":"mu","Mexico":"mx","Moldova":"md","Monaco":"mc","Mongolia":"mn","Montenegro":"me","Morocco":"ma","Mozambique":"mz","Myanmar":"mm","Namibia":"na","Nauru":"nr","Nepal":"np","Netherlands":"nl","New Zealand":"nz","Nicaragua":"ni","Niger":"ne","Nigeria":"ng","North Macedonia":"mk","Norway":"no","Oman":"om","Pakistan":"pk","Palau":"pw","Palestine":"ps","Panama":"pa","Papua New Guinea":"pg","Paraguay":"py","Peru":"pe","Philippines":"ph","Poland":"pl","Portugal":"pt","Qatar":"qa","Romania":"ro","Russia":"ru","Rwanda":"rw","Saint Kitts and Nevis":"kn","Saint Lucia":"lc","Saint Vincent and the Grenadines":"vc","Samoa":"ws","San Marino":"sm","Sao Tome and Principe":"st","Saudi Arabia":"sa","Senegal":"sn","Serbia":"rs","Seychelles":"sc","Sierra Leone":"sl","Singapore":"sg","Slovakia":"sk","Slovenia":"si","Solomon Islands":"sb","Somalia":"so","South Africa":"za","South Korea":"kr","South Sudan":"ss","Spain":"es","Sri Lanka":"lk","Sudan":"sd","Suriname":"sr","Sweden":"se","Switzerland":"ch","Syria":"sy","Taiwan":"tw","Tajikistan":"tj","Tanzania":"tz","Thailand":"th","Timor-Leste":"tl","Togo":"tg","Tonga":"to","Trinidad and Tobago":"tt","Tunisia":"tn","Turkey":"tr","Turkmenistan":"tm","Tuvalu":"tv","Uganda":"ug","Ukraine":"ua","United Arab Emirates":"ae","United Kingdom":"gb","Great Britain":"gb","England":"gb-eng","Scotland":"gb-sct","Wales":"gb-wls","United States":"us","Uruguay":"uy","Uzbekistan":"uz","Vanuatu":"vu","Vatican City":"va","Venezuela":"ve","Vietnam":"vn","Yemen":"ye","Zambia":"zm","Zimbabwe":"zw"};

    fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/rider-score.csv')
      .then(r => r.text())
      .then(text => {
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
        const lines = text.split('\n');
        const data = [];
        const displayColumns = ["Rank","Country","Rider","Team","YOB","Best Result","2nd Best","3rd Best","Score"];

        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(';');
          if (cols.length < 30) continue;

          data.push({
            "Rank": cols[2].trim(),
            "Country": cols[4].trim(),
            "Rider": cols[3].trim(),
            "Team": cols[8].trim(),
            "YOB": cols[6].trim(),
            "Best Result": cols[15].trim() || "–",
            "2nd Best": cols[21].trim() || "–",
            "3rd Best": cols[27].trim() || "–",
            "Score": cols[28].trim()
          });
        }

        const buildRow = row => {
          const countryName = row["Country"] || "";
          const code = countryFlags[countryName] || "";
          const flagHTML = code
            ? `<div class="flag-container"><img class="flag-img" src="https://flagcdn.com/${code}.svg" alt="${countryName}"><div class="tooltip">${countryName}</div></div>`
            : countryName;

          return displayColumns.map(col => {
            if (col === "Country") return flagHTML;
            let val = row[col] ?? "";
            if (col === "Score") {
              if (typeof val === "string") val = val.replace(",", ".");
              const num = parseFloat(val);
              val = isNaN(num) ? "" : num.toFixed(2).replace(".", ",");
            }
            return val;
          });
        });

        const table = $('#riderTable').DataTable({
          data: data,
          dom: 't',
          pageLength: 100,
          lengthMenu: [50, 100, 200, 500],
          order: [[0, 'asc']],
          autoWidth: false,
          columnDefs: [
            { targets: [0,4], className: "text-center" },
            { targets: 8, className: "font-medium" }
          ]
        });

        table.on('draw', () => {
          const meta = table.page.info();
          document.getElementById('infoContainer').textContent = 
            `Showing ${meta.start + 1} to ${meta.end} of ${meta.recordsTotal} riders`;
        });

        const pag = document.getElementById('pagContainer');
        const info = document.getElementById('infoContainer');
        const search = document.getElementById('footerSearch');

        search.addEventListener('input', () => table.search(search.value).draw());

        table.on('draw', () => {
          const meta = table.page.info();
          updateInfo(info, meta);
        });

        function updateInfo(container, info) {
          container.textContent = `Showing ${info.start + 1}–${info.end} of ${info.recordsTotal} riders`;
        }

        setTimeout(() => table.columns.adjust(), 100);
        window.addEventListener('resize', () => setTimeout(() => table.columns.adjust(), 160));

        table.draw(false);
      });
  </script>
</body>
</html>
