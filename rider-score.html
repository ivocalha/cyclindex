<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="cyclindex_logo.png">
  <title>Riders – Cyclindex</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @font-face{font-family:'Suissnord';src:url('Suissnord.otf') format('opentype');font-weight:normal;font-style:normal;font-display:swap;}
    *, *::before, *::after {box-sizing:border-box;}
    body,html{height:100%;margin:0;padding:0;background:linear-gradient(135deg,#0f172a 0%,#1e40af 100%);color:white;overflow:hidden;font-family:system-ui,-apple-system,sans-serif;}

    :root{--nav-height:72px;--footer-height:50px;--pill-bg:rgba(59,130,246,0.35);}

    .nav-bar{position:fixed;top:0;left:0;right:0;height:var(--nav-height);background:rgba(15,23,42,0.96);backdrop-filter:blur(16px);display:flex;align-items:center;justify-content:space-between;padding:0 1.8rem;z-index:3000;box-shadow:0 4px 20px rgba(0,0,0,0.5);}
    .nav-left{display:flex;align-items:center;gap:0.9rem;}
    .nav-logo{height:36px;filter:drop-shadow(0 1px 4px rgba(0,0,0,0.5));}
    .nav-title{font-family:'Suissnord',sans-serif;font-size:1.55rem;margin:0;color:white;}
    .nav-links{display:flex;gap:1.6rem;align-items:center;}
    .nav-links a{font-family:'Suissnord',sans-serif;font-size:1.55rem;color:white;padding:0.4rem 0.85rem;border-radius:0.7rem;text-decoration:none;transition:all .18s;}
    .nav-links a:hover{background:var(--pill-bg);transform:translateY(-2px);}
    .ig-nav{width:34px;height:34px;background:url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="white" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>') center/contain no-repeat;transition:transform .25s ease;}
    .ig-nav:hover{transform:scale(1.22) rotate(10deg);}

    .content-area{position:fixed;top:var(--nav-height);bottom:var(--footer-height);left:0;right:0;overflow:auto;padding:2rem 1.8rem;}
    .block{background:rgba(15,23,42,0.46);backdrop-filter:blur(12px);border-radius:0.9rem;padding:1.2rem;box-shadow:0 5px 20px rgba(0,0,0,0.35);}

    table{width:100%;border-collapse:collapse;font-size:0.9rem;}
    th{background:rgba(15,23,42,0.7);padding:0.8rem 0.6rem;text-align:left;font-weight:600;position:sticky;top:0;z-index:10;}
    td{padding:0.6rem;border-bottom:1px solid rgba(255,255,255,0.08);}
    tr:hover{background:rgba(59,130,246,0.15);}

    .controls{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;}
    #search-input{background:rgba(15,23,42,0.8);border:1px solid rgba(255,255,255,0.3);border-radius:0.5rem;padding:0.4rem 0.8rem;color:white;width:240px;}
    .pagination-info{font-size:0.9rem;opacity:0.8;}
    .pagination button{background:rgba(59,130,246,0.4);border:none;color:white;padding:0.4rem 0.8rem;margin:0 0.3rem;border-radius:0.4rem;cursor:pointer;}
    .pagination button:disabled{background:rgba(255,255,255,0.1);cursor:not-allowed;}

    /* NEW: Season dropdown styling */
    .season-label{font-weight:600;opacity:0.85;margin-right:0.8rem;}
    #season-select{background:rgba(15,23,42,0.8);border:1px solid rgba(255,255,255,0.3);border-radius:0.5rem;padding:0.4rem 0.8rem;color:white;font-size:0.9rem;outline:none;cursor:pointer;}
    #season-select option{background:white !important;color:black !important;}

    /* NEW: Exact same flag styling as index.html */
    .flag{width:26px;height:18px;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.5);object-fit:cover;transition:transform .2s;}
    .flag:hover{transform:scale(1.6);}
    .flag-name{position:absolute;background:rgba(0,0,0,0.92);color:white;font-size:11px;padding:3px 7px;border-radius:4px;opacity:0;transition:opacity .2s;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:6px;white-space:nowrap;z-index:20;}
    .flag-container{position:relative;display:inline-block;}
    .flag-container:hover .flag-name{opacity:1;}

    footer{position:fixed;bottom:0;left:0;right:0;height:var(--footer-height);background:rgba(15,23,42,0.96);backdrop-filter:blur(12px);border-top:1px solid rgba(255,255,255,0.1);z-index:2000;display:flex;align-items:center;justify-content:space-between;padding:0 1.8rem;font-size:0.85rem;color:rgba(255,255,255,0.55);}
  </style>
</head>
<body>

  <div class="nav-bar">
    <div class="nav-left">
      <img src="cyclindex_logo.png" alt="Cyclindex" class="nav-logo">
      <h1 class="nav-title">Cyclindex</h1>
    </div>
    <div class="nav-links">
      <a href="results-log.html">Results</a>
      <a href="rider-score.html">Riders</a>
      <a href="team-score.html">Teams</a>
      <a href="nation-score.html">Nations</a>
      <a href="how-it-works.html">How It Works</a>
    </div>
    <a href="https://www.instagram.com/cyclindex/" target="_blank" aria-label="Instagram">
      <div class="ig-nav"></div>
    </a>
  </div>

  <div class="content-area">
    <div class="block">
      <h2 style="font-family:'Suissnord',sans-serif;font-size:1.8rem;margin:0 0 1.5rem;">Rider Rankings</h2>

      <!-- MODIFIED: Controls row with Season dropdown on the left -->
      <div class="controls">
        <div style="display:flex;align-items:center;">
          <span class="season-label">Season</span>
          <select id="season-select"><option>Loading seasons...</option></select>
        </div>

        <div class="pagination-info" id="info">Loading...</div>

        <input type="text" id="search-input" placeholder="Search rider, team or country...">
      </div>

      <table id="rider-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Nation</th>
            <th>Rider</th>
            <th>Team</th>
            <th>YOB</th>
            <th>Best Result</th>
            <th>2nd Best</th>
            <th>3rd Best</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="pagination" id="pagination" style="margin-top:1rem;text-align:center;">
        <button id="prev-btn">Previous</button>
        <span id="page-info"></span>
        <button id="next-btn">Next</button>
      </div>
    </div>
  </div>

  <footer>
    <div></div>
    <div id="copyright"></div>
  </footer>

  <script>
    document.getElementById('copyright').textContent = `© ${new Date().getFullYear()} Cyclindex`;

    const flags = {"Afghanistan":"af","Albania":"al","Algeria":"dz","Andorra":"ad","Angola":"ao","Antigua and Barbuda":"ag","Argentina":"ar","Armenia":"am","Australia":"au","Austria":"at","Azerbaijan":"az","Bahamas":"bs","Bahrain":"bh","Bangladesh":"bd","Barbados":"bb","Belarus":"by","Belgium":"be","Belize":"bz","Benin":"bj","Bermuda":"bm","Bhutan":"bt","Bolivia":"bo","Bosnia and Herzegovina":"ba","Botswana":"bw","Brazil":"br","Brunei":"bn","Bulgaria":"bg","Burkina Faso":"bf","Burundi":"bi","Cambodia":"kh","Cameroon":"cm","Canada":"ca","Cape Verde":"cv","Cayman Islands":"ky","Central African Republic":"cf","Chad":"td","Chile":"cl","China":"cn","Colombia":"co","Comoros":"km","Congo":"cg","Costa Rica":"cr","Croatia":"hr","Cuba":"cu","Cyprus":"cy","Czech Republic":"cz","Denmark":"dk","Djibouti":"dj","Dominica":"dm","Dominican Republic":"do","Ecuador":"ec","Egypt":"eg","El Salvador":"sv","Equatorial Guinea":"gq","Eritrea":"er","Estonia":"ee","Eswatini":"sz","Ethiopia":"et","Fiji":"fj","Finland":"fi","France":"fr","Gabon":"ga","Gambia":"gm","Georgia":"ge","Germany":"de","Ghana":"gh","Greece":"gr","Grenada":"gd","Guatemala":"gt","Guinea":"gn","Guinea-Bissau":"gw","Guyana":"gy","Haiti":"ht","Honduras":"hn","Hong Kong":"hk","Hungary":"hu","Iceland":"is","India":"in","Indonesia":"id","Iran":"ir","Iraq":"iq","Ireland":"ie","Israel":"il","Italy":"it","Ivory Coast":"ci","Jamaica":"jm","Japan":"jp","Jordan":"jo","Kazakhstan":"kz","Kenya":"ke","Kiribati":"ki","Kosovo":"xk","Kuwait":"kw","Kyrgyzstan":"kg","Laos":"la","Latvia":"lv","Lebanon":"lb","Lesotho":"ls","Liberia":"lr","Libya":"ly","Liechtenstein":"li","Lithuania":"lt","Luxembourg":"lu","Madagascar":"mg","Malawi":"mw","Malaysia":"my","Maldives":"mv","Mali":"ml","Malta":"mt","Marshall Islands":"mh","Mauritania":"mr","Mauritius":"mu","Mexico":"mx","Moldova":"md","Monaco":"mc","Mongolia":"mn","Montenegro":"me","Morocco":"ma","Mozambique":"mz","Myanmar":"mm","Namibia":"na","Nauru":"nr","Nepal":"np","Netherlands":"nl","New Zealand":"nz","Nicaragua":"ni","Niger":"ne","Nigeria":"ng","North Macedonia":"mk","Norway":"no","Oman":"om","Pakistan":"pk","Palau":"pw","Palestine":"ps","Panama":"pa","Papua New Guinea":"pg","Paraguay":"py","Peru":"pe","Philippines":"ph","Poland":"pl","Portugal":"pt","Qatar":"qa","Romania":"ro","Russia":"ru","Rwanda":"rw","Saint Kitts and Nevis":"kn","Saint Lucia":"lc","Saint Vincent and the Grenadines":"vc","Samoa":"ws","San Marino":"sm","Sao Tome and Principe":"st","Saudi Arabia":"sa","Senegal":"sn","Serbia":"rs","Seychelles":"sc","Sierra Leone":"sl","Singapore":"sg","Slovakia":"sk","Slovenia":"si","Solomon Islands":"sb","Somalia":"so","South Africa":"za","South Korea":"kr","South Sudan":"ss","Spain":"es","Sri Lanka":"lk","Sudan":"sd","Suriname":"sr","Sweden":"se","Switzerland":"ch","Syria":"sy","Taiwan":"tw","Tajikistan":"tj","Tanzania":"tz","Thailand":"th","Timor-Leste":"tl","Togo":"tg","Tonga":"to","Trinidad and Tobago":"tt","Tunisia":"tn","Turkey":"tr","Turkmenistan":"tm","Tuvalu":"tv","Uganda":"ug","Ukraine":"ua","United Arab Emirates":"ae","United Kingdom":"gb","Great Britain":"gb","England":"gb-eng","Scotland":"gb-sct","Wales":"gb-wls","United States":"us","Uruguay":"uy","Uzbekistan":"uz","Vanuatu":"vu","Vatican City":"va","Venezuela":"ve","Vietnam":"vn","Yemen":"ye","Zambia":"zm","Zimbabwe":"zw"};

    const flagImg = country => {
      const code = flags[country] || 'xx';
      return `<div class="flag-container">
                <img src="https://flagcdn.com/w40/${code}.png" width="26" height="18" alt="${country}" class="flag">
                <div class="flag-name">${country}</div>
              </div>`;
    };

    const tableBody = document.querySelector('#rider-table tbody');
    const seasonSelect = document.getElementById('season-select');
    const searchInput = document.getElementById('search-input');
    const infoDiv = document.getElementById('info');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const pageInfo = document.getElementById('page-info');

    let allRiders = [];
    let filteredRiders = [];
    let currentSeason = null;
    let currentPage = 1;
    const pageSize = 50;

    function renderTable() {
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageData = filteredRiders.slice(start, end);

      tableBody.innerHTML = pageData.map((r, i) => `
        <tr>
          <td>${start + i + 1}</td>
          <td>${flagImg(r.country)}</td>
          <td>${r.rider}</td>
          <td>${r.team}</td>
          <td>${r.yob}</td>
          <td>${r.best}</td>
          <td>${r.second}</td>
          <td>${r.third}</td>
          <td>${r.score}</td>
        </tr>
      `).join('');

      infoDiv.textContent = `Showing ${start + 1}–${Math.min(end, filteredRiders.length)} of ${filteredRiders.length} riders`;
      pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(filteredRiders.length / pageSize) || 1}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = end >= filteredRiders.length;
    }

    function filterData() {
      const query = searchInput.value.toLowerCase();
      filteredRiders = allRiders.filter(r =>
        r.season === currentSeason &&
        (r.rider.toLowerCase().includes(query) ||
         r.team.toLowerCase().includes(query) ||
         r.country.toLowerCase().includes(query))
      );
      currentPage = 1;
      renderTable();
    }

    fetch('https://raw.githubusercontent.com/ivocalha/cyclindex/main/rider-score.csv')
      .then(r => r.text())
      .then(text => {
        if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
        const lines = text.split('\n');
        const seasons = new Set();
        const riders = [];

        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(';');
          if (cols.length < 30) continue;
          const season = cols[0].trim();
          if (season) seasons.add(season);

          riders.push({
            season: season,
            rank: parseInt(cols[2]) || 9999,
            rider: cols[3].trim(),
            country: cols[4].trim(),
            team: cols[8].trim(),
            yob: cols[6].trim(),
            best: cols[15].trim() || '–',
            second: cols[21].trim() || '–',
            third: cols[27].trim() || '–',
            score: cols[28].trim()
          });
        }

        const seasonArray = Array.from(seasons).filter(s => /^\d{4}$/.test(s)).sort((a,b) => b - a);
        currentSeason = seasonArray[0] || new Date().getFullYear().toString();

        seasonSelect.innerHTML = seasonArray.map(y =>
          `<option value="${y}" ${y === currentSeason ? 'selected' : ''}>${y}</option>`
        ).join('');

        allRiders = riders;
        filterData();
      });

    seasonSelect.addEventListener('change', () => {
      currentSeason = seasonSelect.value;
      filterData();
    });

    searchInput.addEventListener('input', filterData);
    prevBtn.addEventListener('click', () => { currentPage--; renderTable(); });
    nextBtn.addEventListener('click', () => { currentPage++; renderTable(); });
  </script>
</body>
</html>
